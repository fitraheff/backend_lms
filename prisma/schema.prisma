generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  STUDENT
  INSTRUCTOR
  ADMIN
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique @db.VarChar(255)
  googleId          String?  @unique @db.VarChar(255)
  emailVerified     Boolean  @default(false)

  name              String?  @db.VarChar(255)
  password          String?  @db.VarChar(255)

  role              Role     @default(STUDENT)

  refreshToken      String?  @db.Text  

  createdAt         DateTime @default(now()) @db.Timestamptz(3)
  updatedAt         DateTime @updatedAt @db.Timestamptz(3)

  modules           Module[]
  enrolls           Enroll[]

  @@index([email])
  @@index([role])

  @@map("users")
}

model Module {
  id            String    @id @default(cuid())
  title         String    @unique @db.VarChar(255)
  desc          String    @db.VarChar(1000)
  price         Int
  cover         String    @db.Text

  content       ModuleContent[]
  enroll        Enroll[]

  category      Category  @relation(fields: [categoryId], references: [id])
  categoryId    String      

  instructor    User      @relation(fields: [instructorId], references: [id])
  instructorId  String

  createdAt     DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime  @updatedAt @db.Timestamptz(3)

  @@map("modules")
}

model Category {
  id      String    @id @default(cuid())
  name    String    @db.VarChar(255)

  createdAt  DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt  DateTime  @updatedAt @db.Timestamptz(3)

  modules    Module[]

  @@map("category")
}

enum Type {
  PDF
  VIDEO
}

model ModuleContent {
  id         String   @id @default(cuid())
  title      String   @db.VarChar(255)
  type       Type  
  file_link  String

  module     Module   @relation(fields: [moduleId], references: [id])
  moduleId   String

  createdAt  DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt  DateTime  @updatedAt @db.Timestamptz(3)

  @@map("module_content")
}

model Enroll {
  id        String    @id @default(cuid())

  student   User      @relation(fields: [studentId], references: [id])
  studentId String
  module    Module    @relation(fields: [moduleId], references: [id])
  moduleId  String

  enrolledAt  DateTime  @default(now()) @db.Timestamptz(3)

  @@map("enroll") 
}